# どのログを集めるか

## 対象となるログの種類例

- スタッフ業務環境
  - 通信フロー・Proxyログ: C2 (Command & Control) 通信の検出・調査
  - DNSログ: C2通信の検出・調査
  - PC上の動作に関するログ: マルウェアの検出・調査
  - ADのログ（アカウントがAD管理の場合）: 感染後のAD攻撃の検出・調査
  - アンチウィルスソフトのログ : マルウェアの検出
  - リモートアクセスのログ（VPNなど） : 外部からの不正アクセス
- SaaS
  - 認証・認可ログ : 外部・侵入からの不正操作の検出
  - 操作ログ : 不正操作全般の調査
- サービスインフラ
  - サービス（クラウド）の操作ログ: サービス・インフラそのものへの侵入の検出・調査
  - サーバ（インスタンス）のログ: サービスへの侵入の検出・調査
  - 通信フローログ: 侵入後の調査
- アプリケーション
  - アプリログ: アプリ侵入の調査
  - DBログ: アプリ侵入の調査
- その他セキュリティ監視装置

参考文献: [IPA 「企業における情報システムのログ管理に関する実態調査」報告書について](https://www.ipa.go.jp/files/000052999.pdf)


## どこまでのログを集めるべきか



- すべてのログを保存するのが理想的ではあるが「すべて」とはなにか？
    - 現在取得可能なログの種類が「すべて」？ → No、必要なら新たにログ収集のための監視装置（ツール等含む）を導入するべき
    - 組織に合わせて必要なログを選定しなければならない
- どのように選定するか
    - 想定される情報に対する攻撃のリスクを洗い出してみる（例：メールに添付されたマルウェアに感染してファイルサーバ上の情報を窃取される）
    - その事象が発生したときに、検出できるか、あるいは追跡・調査が必要かを考える
        - これは防止も含めて考えておいたほうがよい
        - なるべく網羅的に対策がなされていることが重要ではあるが、必ずしも全てのリスクに対して防止・検出・対応がそろっていないといけないわけでもない
        - リスクを受容したり防止できないので検出する、などの考え方もある
    - 検出や対応を必要とするリスクを特定できたら、次はどのような情報（ログ）が取得できていないといけないか考える
        - OS、システム、ネットワーク、サービスなどからどのような情報がとれれば検知や調査ができるか
        - 粒度はいくらでも細かくできるが検知や調査に必要最低限のレベルはどこかを見極め、現実的なバランスを探る
            - 例えば、OSのシステムコールの全ログや定期的にメモリダンプを取得できれば詳細な追跡ができるかもしれないが、そこまでしなくても起動したプロセスとその関連情報だけ取得できれば必要十分かもしれない
        - ログの保存のパートで改めて説明するが、取得・保存できるログの量には限界があるためそこの費用対効果も考えて良い感じのポイントを考える


## 集めたログの保管

- 保管期間は法令・ガイドラインなどで直接指定されている事業がある場合、それに従う必要がある
- そうでない場合はIPAのログ保存期間に関する法令・ガイドラインが参考になる
- 実務経験上の感覚としては
    - 3ヶ月〜6ヶ月程度のログはすぐに検索・閲覧できるようにしておく
    - 逆にアラート分析の段階や初動対応で3ヶ月以上に遡ることはほとんどない
    - ただしインシデント発生時には1年ほど遡ることはあり得るため最大1年〜2年ぐらいは（取り出しに時間・コストがかかってもいいので）保管しておくべき

**参考文献**

- 企業における情報システムのログ管理に関する実態調査 調査報告書 https://www.ipa.go.jp/files/000052999.pdf 64-65p 表 4-2： ログ保存期間の目安